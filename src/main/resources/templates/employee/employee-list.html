<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Employee List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/left-navigation.css}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    
    
    .content-container {
      padding: 20px;
      margin-left: 250px;
      transition: margin-left 0.3s;
      width: 100%;
    }
    
    /* Employee table container */
    .employee-table-container {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 30px;
      width: 100%;
      overflow-x: auto; /* Enable horizontal scrolling on small screens */
    }
    
    /* Page header styles */
    h1{
            font-size: 24px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 30px;
        }
    
    .page-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }
    
    /* Search and filter styles */
    .search-filter-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .search-box {
      position: relative;
      width: 100%;
      max-width: 300px;
    }
    
    .search-box input {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .search-box i {
      position: absolute;
      left: 15px;
      top: 12px;
      color: #888;
    }
    
    .search-box {
	  position: relative;
	  width: 100%;
	  max-width: 300px;
	  display: flex;
	}
	
	.search-box input {
	  width: 100%;
	  padding: 10px 15px 10px 40px;
	  border: 1px solid #ddd;
	  border-radius: 4px 0 0 4px;
	  flex-grow: 1;
	}
	
	.search-box i {
	  position: absolute;
	  left: 15px;
	  top: 12px;
	  color: #888;
	  z-index: 1;
	}
	
	.search-button {
	  background-color: #007bff;
	  color: white;
	  border: none;
	  border-radius: 0 4px 4px 0;
	  padding: 0 15px;
	  cursor: pointer;
	  transition: background-color 0.3s;
	}
	
	.search-button:hover {
	  background-color: #0069d9;
	}
    
    .filter-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .filter-select {
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
    }
    
    /* Button styles */
    .add-employee-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .add-employee-btn:hover {
      background-color: #45a049;
      color: white;
      text-decoration: none;
    }
    
    /* Table styles */
    .table-responsive {
      width: 100%;
      overflow-x: auto;
    }
    
    table.employee-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px; /* Ensure table doesn't shrink too much */
    }
    
    table.employee-table th {
      background-color: #f8f9fa;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #495057;
      border-bottom: 2px solid #dee2e6;
    }
    
    table.employee-table td {
      padding: 15px;
      border-bottom: 1px solid #e9ecef;
      color: #212529;
    }
    
    table.employee-table tr:hover {
      background-color: #f1f3f5;
    }
    
    /* Status badge styles */
    .status-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      display: inline-block;
    }
    
    .status-active {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-inactive {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .status-onleave {
      background-color: #fff3cd;
      color: #856404;
    }
    
    /* Action buttons */
    .action-column {
      white-space: nowrap;
      text-align: right;
    }
    
    .action-btn {
      background: none;
      border: none;
      color: #6c757d;
      margin-left: 5px;
      cursor: pointer;
      padding: 5px;
    }
    
    .view-btn {
      color: #007bff;
    }
    
    .edit-btn {
      color: #28a745;
    }
    
    .delete-btn {
      color: #dc3545;
    }
    
    /* Pagination styles */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .page-info {
      color: #6c757d;
    }
    
    .pagination {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
      flex-wrap: wrap;
    }
    
    .pagination li {
      margin: 0 5px 5px 0;
    }
    
    .pagination button {
      display: inline-block;
      padding: 5px 10px;
      border: 1px solid #ddd;
      color: #007bff;
      text-decoration: none;
      border-radius: 4px;
    }
    
    /* Card view for mobile */
    .employee-cards {
      display: none;
    }
    
    .employee-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      padding: 15px;
    }
    
    .employee-card h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
    }
    
    .employee-card-info {
      margin-bottom: 10px;
    }
    
    .employee-card-info span {
      font-weight: bold;
      display: inline-block;
      width: 100px;
    }
    
    
    /* Responsive styles */
    @media screen and (max-width: 1200px) {
      .content-container {
        margin-left: 0;
        width: 100%;
      }
    }
    
    @media screen and (max-width: 992px) {
      .search-filter-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .search-box {
        max-width: 100%;
        margin-bottom: 10px;
      }
      
      .filter-options {
        width: 100%;
      }
      
      .filter-select {
        flex-grow: 1;
      }
    }
    
    @media screen and (max-width: 768px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .pagination-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .filter-options {
        flex-direction: column;
      }
      
      .filter-select {
        width: 100%;
      }
      
      /* Switch to card view on smaller screens */
      .table-responsive {
        display: none;
      }
      
      .employee-cards {
        display: block;
      }
    }
    
    @media screen and (max-width: 480px) {
      .employee-table-container {
        padding: 15px;
      }
      
      .page-title {
        font-size: 20px;
      }
      
      .add-employee-btn {
        width: 100%;
        justify-content: center;
      }
    }
    /* Update responsive styles */
	@media screen and (max-width: 480px) {
	  .search-box {
	    max-width: 100%;
	  }
	}
  </style>
</head>
<body>
<header th:replace="base/left-navigation :: header"></header>
<div class="main-container">
  <nav th:replace="base/left-navigation :: sidebar"></nav>
  <div class="content-container">
    <div class="employee-table-container">
      <h1>Employee Directory</h1>
      
      <div class="search-filter-container">
        <div class="search-box">
		    <i class="fa fa-search"></i>
		    <input type="text" id="employeeSearch" placeholder="Search employees...">
		    <button id="searchButton" class="search-button">Search</button>
		  </div>
        <div class="filter-options">
          <select class="filter-select" id="departmentFilter">
            <option value="">All Departments</option>
            <option value="HR">Human Resources</option>
            <option value="IT">Information Technology</option>
            <option value="FINANCE">Finance</option>
            <option value="MARKETING">Marketing</option>
            <option value="OPERATIONS">Operations</option>
            <option value="SALES">Sales</option>
            <option value="RD">Research & Development</option>
          </select>
          <select class="filter-select" id="statusFilter">
            <option value="">All Status</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
            <option value="ONLEAVE">On Leave</option>
          </select>
        </div>
      </div>
      
      <!-- Table View (for larger screens) -->
      <div class="table-responsive">
        <table class="employee-table" id="employee-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Department</th>
              <th>Position</th>
              <th>Work Location</th>
              <th>Join Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            
          </tbody>
        </table>
      </div>
      
      <!-- Card View (for mobile screens) -->
      <div class="employee-cards" id="employee-cards">
        
      </div>
      
      <div class="pagination-container">
        <div class="page-info">
          
        </div>
        <ul class="pagination">
          <li><button id="prevBtn" class="disabled">&laquo; prev</button></li>
          <li><button id="nextBtn">&raquo; next</button></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script th:src="@{/js/left-navigation.js}"></script>
<script>
  $(document).ready(function() {
    
	let currentPage = 0;
	let keyword = ""
	
	function fetchEmployees(page, keyword){
		$.ajax({
			url: "/fetchEmployee",
			method: "GET",
			data: {page: page, size: 8, keyword: keyword},
			success: function(response){
				const tbody = $("#employee-table tbody");
				const employeeCards = $("#employee-cards");
				employeeCards.empty();
				tbody.empty();
				
				const pageInfo = $(".page-info");
				pageInfo.empty();
				pageInfo.append(`Showing <span>${response.currentPage+1}</span> to <span>${response.totalPages}</span>`);
				
				response.employees.forEach(emp => {
					const statusClass =
						  emp.status === 'ACTIVE' ? 'status-active' :
						  emp.status === 'INACTIVE' ? 'status-inactive' : 'status-onleave';
					console.log(statusClass);
					tbody.append(
							`<tr>
				              <td>${emp.firstName} ${emp.lastName}</td>
				              <td>${emp.department}</td>
				              <td>${emp.position}</td>
				              <td>${emp.city}</td>
				              <td>${emp.joinDate}</td>
				              <td><span class="status-badge ${statusClass}">${emp.status}</span>
				              </td>
				            </tr>
							`
					)
					employeeCards.append(
							` 
					        <div class="employee-card">
					          <h3>${emp.firstName} ${emp.lastName}</h3>
					          <div class="employee-card-info">
					            <span>Department:</span> <span>${emp.department}</span>
					          </div>
					          <div class="employee-card-info">
					            <span>Position:</span> <span >${emp.position}</span>
					          </div>
					          <div class="employee-card-info">
					            <span>Location:</span> <span>${emp.city}</span>
					          </div>
					          <div class="employee-card-info">
					            <span>Status:</span> 
					            <span th:class="'status-badge ${statusClass}">${emp.status}</span>
					          </div>
					        </div>
							`
					);
					currentPage = response.currentPage;
		            $("#prevBtn").prop("disabled", currentPage === 0);
		            $("#nextBtn").prop("disabled", currentPage >= response.totalPages - 1);
				});
			},
			error: function(xhr, status, error) {
				console.error("AJAX Error:", status, error);
				console.error("Response:", xhr.responseText);
			}
		});
	}
	$("#searchButton").on("click", function(){
		filter = $("#employeeSearch").val();
		fetchEmployee(0, filter);
	});
	
    fetchEmployees(0, "");
    
    $("#prevBtn").click(function () {
        if (currentPage > 0) fetchEmployees(currentPage - 1, keyword);
    });

    $("#nextBtn").click(function () {
        fetchEmployees(currentPage + 1, keyword);
    });
    
    // Search functionality
    $("#employeeSearch").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $(".employee-table tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
      
      // Also filter card view
      $(".employee-card").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
    
    // Department filter
    $("#departmentFilter").on("change", function() {
      var value = $(this).val().toLowerCase();
      if (value === "") {
        $(".employee-table tbody tr").show();
        $(".employee-card").show();
      } else {
        // Filter table rows
        $(".employee-table tbody tr").filter(function() {
          $(this).toggle($(this).children("td").eq(1).text().toLowerCase() === value);
        });
        
        // Filter cards
        $(".employee-card").filter(function() {
          var deptText = $(this).find(".employee-card-info:nth-child(2)").text().toLowerCase();
          $(this).toggle(deptText.indexOf(value) > -1);
        });
      }
    });
    
    // Status filter
    $("#statusFilter").on("change", function() {
      var value = $(this).val().toLowerCase();
      if (value === "") {
        $(".employee-table tbody tr").show();
        $(".employee-card").show();
      } else {
        // Filter table rows
        $(".employee-table tbody tr").filter(function() {
          $(this).toggle($(this).find(".status-badge").text().toLowerCase() === value);
        });
        
        // Filter cards
        $(".employee-card").filter(function() {
          $(this).toggle($(this).find(".status-badge").text().toLowerCase() === value);
        });
      }
    });
    
   
  });
</script>
</body>
</html>